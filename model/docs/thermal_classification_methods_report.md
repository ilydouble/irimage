# 热力图ICAS分类方法对比报告

## 概述

本报告对比了三种不同的热力图ICAS（颅内动脉粥样硬化性狭窄）分类方法的性能和特点。这三种方法分别基于：
1. **传统特征提取 + 机器学习**（train_thermal_classifier1.py）
2. **多模态特征融合**（train_thermal_classifier2.py）  
3. **对比学习 + 深度学习**（train_thermal_classifier3.py）

## 数据集概况

- **总样本数**：950张热力图
- **ICAS样本**：303张（31.9%）
- **Non-ICAS样本**：647张（68.1%）
- **类别不平衡比例**：1:2.14
- **数据分割**：训练集70%，验证集15%，测试集15%
- **临床数据匹配率**：100%（950/950张图像成功匹配临床特征）

## 性能对比总览

| 方法 | 最佳模型 | 测试准确率 | 测试F1分数 | 测试AUC | 训练时间 | 特征维度 |
|------|----------|------------|------------|---------|----------|----------|
| **方法二（多模态）** | **LightGBM** | **74.83%** | **53.85%** | **75.46%** | **28.51秒** | **42维** |
| 方法一（特征提取） | LogisticRegression | 51.75% | 37.84% | 54.14% | 28.12秒 | 26维 |
| 方法三（对比学习） | *待测试* | *-* | *-* | *-* | *-* | *-* |

## 方法详述

### 方法一：基于特征提取的分类器（train_thermal_classifier1.py）

#### 核心思想
使用传统计算机视觉方法提取图像特征，结合多种机器学习算法进行分类。

#### 特征提取策略
1. **温度特征**：基于HSV色彩空间和红蓝比值
2. **纹理特征**：分块LBP特征（4×4网格）
3. **形状特征**：轮廓和边界框特征

#### 数据预处理
- **特征维度**：原始356维 → 特征选择后26维
- **特征选择**：方差阈值 + SelectKBest
- **类别权重**：Non-ICAS: 0.734, ICAS: 1.568

### 方法二：多模态特征融合分类器（train_thermal_classifier2.py）

#### 核心思想
融合热力图图像特征和患者临床数据，构建多模态分类模型。

#### 特征融合策略
1. **图像特征（324维）**：
   - 温度特征：HSV色调统计、红蓝比值特征
   - 纹理特征：分块LBP直方图、全局LBP统计
   - 形状特征：轮廓、边界框、前景区域特征

2. **临床特征（13维）**：
   - **基础指标**：年龄、性别、身高、体重、BMI
   - **身体测量**：腰围、臀围、颈围
   - **比值特征**：腰臀比、腰身比、颈身比
   - **分类特征**：BMI分类、年龄分组

#### 数据匹配与处理
- **患者匹配**：523个患者成功匹配（99.8%匹配率）
- **特征选择**：337维 → 42维（图像29维 + 临床13维）
- **标准化策略**：图像特征用RobustScaler，临床特征用StandardScaler
- **类别权重**：Non-ICAS: 0.733, ICAS: 1.573

### 方法三：对比学习深度分类器（train_thermal_classifier3.py）

#### 核心思想
采用两阶段训练策略：先通过对比学习学习图像表征，再进行分类微调。

*（详细描述保持不变）*

## 详细性能分析

### 方法一结果（传统特征提取）

#### 模型性能对比
| 模型 | 验证准确率 | 验证F1分数 | AUC | 训练时间(秒) |
|------|------------|------------|-----|-------------|
| **LogisticRegression** | **53.52%** | **44.07%** | **54.14%** | **0.01** |
| SVM | 54.23% | 41.44% | 55.72% | 0.05 |
| GradientBoosting | 68.31% | 36.62% | 63.37% | 0.68 |
| XGBoost | 70.42% | 34.38% | 66.76% | 0.40 |
| RandomForest | 67.61% | 25.81% | 65.54% | 0.15 |

#### 测试集详细结果
- **测试准确率**：51.75%
- **测试F1分数**：37.84%
- **分类报告**：
  - Non-ICAS：精确率68%, 召回率55%, F1分数61%
  - ICAS：精确率32%, 召回率46%, F1分数38%

### 方法二结果（多模态融合）

#### 模型性能对比
| 模型 | 验证准确率 | 验证F1分数 | AUC | 训练时间(秒) |
|------|------------|------------|-----|-------------|
| **LightGBM** | **72.03%** | **47.37%** | **73.53%** | **0.81** |
| CatBoost | 71.33% | 43.84% | 72.52% | 0.60 |
| XGBoost | 70.63% | 34.38% | 68.74% | 0.66 |
| RandomForest | 72.03% | 31.03% | 71.20% | 0.32 |
| LogisticRegression | 58.04% | 45.45% | 55.56% | 0.01 |
| SVM | 59.44% | 42.00% | 61.00% | 0.11 |

#### 测试集详细结果
- **测试准确率**：74.83%
- **测试F1分数**：53.85%
- **测试AUC**：75.46%
- **分类报告**：
  - Non-ICAS：精确率77%, 召回率89%, F1分数83%
  - ICAS：精确率66%, 召回率46%, F1分数54%

## 关键发现与对比分析

### 性能提升显著
1. **准确率提升**：74.83% vs 51.75%（+23.08%）
2. **F1分数提升**：53.85% vs 37.84%（+16.01%）
3. **AUC提升**：75.46% vs 54.14%（+21.32%）

### 多模态融合优势
1. **临床特征价值**：13维临床特征显著提升分类性能
2. **特征互补性**：图像特征（29维）+ 临床特征（13维）= 更强表达能力
3. **数据匹配成功**：99.8%的匹配率确保了多模态信息的有效利用

### 模型选择差异
- **方法一**：简单的LogisticRegression表现最佳
- **方法二**：复杂的LightGBM梯度提升模型表现最佳
- **原因分析**：多模态特征更复杂，需要更强的模型来捕捉特征间的非线性关系

### Focal Loss效果分析
- **方法一**：Focal Loss无明显改善
- **方法二**：部分模型（如LightGBM_Focal）性能下降
- **结论**：在当前数据集上，传统的类别权重策略更有效

## 方法优缺点对比

### 方法一：传统特征提取
**优点：**
- ✅ 训练速度快（28.12秒）
- ✅ 模型简单，可解释性强
- ✅ 资源需求低

**缺点：**
- ❌ 性能有限（F1: 37.84%）
- ❌ 特征表达能力不足
- ❌ 对ICAS类别识别困难

### 方法二：多模态融合
**优点：**
- ✅ **性能显著提升**（F1: 53.85%）
- ✅ **信息更全面**，符合临床实际
- ✅ **特征互补性强**
- ✅ 训练时间仍然可接受（28.51秒）

**缺点：**
- ❌ 依赖临床数据完整性
- ❌ 数据预处理更复杂
- ❌ 特征维度较高

**关键成功因素：**
1. **高质量数据匹配**：99.8%的匹配率
2. **有效特征选择**：从337维降至42维
3. **合适的模型选择**：LightGBM处理复杂特征关系

## 临床应用价值

### 诊断准确性提升
- **Non-ICAS识别**：召回率从55%提升至89%
- **ICAS识别**：F1分数从38%提升至54%
- **整体性能**：AUC从54.14%提升至75.46%

### 实际应用建议

#### 临床筛查场景
- **推荐方法二**：结合图像和临床数据
- **优势**：更高的准确率和可靠性
- **应用**：辅助医生进行ICAS风险评估

#### 快速筛查场景
- **备选方法一**：仅使用图像特征
- **优势**：无需临床数据，部署简单
- **应用**：大规模筛查的初步评估

#### 研究分析场景
- **推荐方法二**：全面的多模态分析
- **优势**：提供更丰富的特征洞察
- **应用**：ICAS风险因素研究

## 技术创新点

### 多模态特征工程
1. **智能数据匹配**：基于文件名的患者ID提取
2. **差异化标准化**：针对不同类型特征的专门处理
3. **特征选择优化**：有效降维同时保持性能

### 临床特征设计
1. **比值特征**：腰臀比、腰身比等医学相关指标
2. **分类特征**：BMI分类、年龄分组等离散化处理
3. **缺失值策略**：基于特征类型的智能填充

## 未来改进方向

### 短期优化
1. **阈值调优**：针对ICAS检测优化分类阈值
2. **特征工程**：探索更多临床相关特征
3. **模型集成**：结合多个模型的预测结果

### 长期发展
1. **深度学习融合**：将方法三与多模态特征结合
2. **时序数据**：纳入患者历史数据
3. **多中心验证**：在不同医院数据上验证泛化性

### 临床转化
1. **决策支持系统**：开发临床决策支持工具
2. **风险评分模型**：提供ICAS风险评分
3. **个性化诊疗**：基于患者特征的个性化建议

## 结论

**多模态特征融合方法（方法二）在当前数据集上表现最佳**，相比传统特征提取方法实现了显著的性能提升：

- **准确率提升23.08%**（51.75% → 74.83%）
- **F1分数提升16.01%**（37.84% → 53.85%）
- **AUC提升21.32%**（54.14% → 75.46%）

这一结果证明了**临床特征与图像特征融合的重要价值**，为热力图ICAS分类提供了一个实用且有效的解决方案。

---

*报告生成时间：2025年1月26日*
*版本：v2.0*
*基于方法一和方法二的完整测试结果*